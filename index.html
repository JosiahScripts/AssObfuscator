<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>REO Obfuscator</title>
<style>
  .mode-btn { background-color: red; color: white; padding: 8px 16px; margin: 5px; border: none; cursor: pointer; }
  .mode-btn.selected { background-color: green; }
  #obfuscateBtn { background-color: #007BFF; color: white; padding: 8px 16px; margin: 5px; border: none; cursor: pointer; }
  #codeInput { width: 90%; height: 200px; margin-top: 10px; font-family: monospace; }
</style>
</head>
<body>
<h1>REO Obfuscator</h1>
<button id="normalBtn" class="mode-btn">Normal Mode</button>
<button id="hardBtn" class="mode-btn">Hard Mode</button><br>
<input type="file" id="fileInput" accept=".lua"><br>
<textarea id="codeInput" placeholder="Paste your Lua code here"></textarea><br>
<button id="obfuscateBtn">Obfuscate</button>
<script>
function getRandomName(existing) {
  const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
  const chars = letters + '0123456789_';
  const reserved = ['and','break','do','else','elseif','end','false','for','function','if','in','local','nil','not','or','repeat','return','then','true','until','while','load','loadstring','string','table','concat','char'];
  let name;
  do {
    const len = 5 + Math.floor(Math.random() * 4);
    name = letters.charAt(Math.random() * letters.length | 0);
    for (let i = 1; i < len; i++) name += chars.charAt(Math.random() * chars.length | 0);
  } while (existing.includes(name) || reserved.includes(name.toLowerCase()));
  existing.push(name);
  return name;
}

const normalBtn = document.getElementById('normalBtn'),
      hardBtn = document.getElementById('hardBtn'),
      fileInput = document.getElementById('fileInput'),
      codeInput = document.getElementById('codeInput'),
      obfuscateBtn = document.getElementById('obfuscateBtn');
let mode = null;

normalBtn.onclick = () => {
  mode = 'normal';
  normalBtn.classList.add('selected');
  hardBtn.classList.remove('selected');
};

hardBtn.onclick = () => {
  mode = 'hard';
  hardBtn.classList.add('selected');
  normalBtn.classList.remove('selected');
};

fileInput.onchange = e => {
  const f = e.target.files[0];
  if (f) {
    const r = new FileReader();
    r.onload = e => codeInput.value = e.target.result;
    r.readAsText(f);
  }
};

obfuscateBtn.onclick = () => {
  const m = mode || 'normal';
  if (!mode) normalBtn.classList.add('selected');
  const code = codeInput.value;
  if (!code.trim()) return alert('Enter Lua code');

  const raw = [];
  for (let i = 0; i < code.length; i++) raw.push(code.charCodeAt(i));

  const names = [];
  const arrName = getRandomName(names);
  const strName = getRandomName(names);
  const fnName = getRandomName(names);
  const idxName = getRandomName(names);
  const offsetName = getRandomName(names);
  const chunkName = m === 'hard' ? getRandomName(names) : null;

  const offset = Math.floor(Math.random() * 100) + 1;

  const parts = ['--[[OBFUSCATED BY REO]]--', '', 'do', `  local ${offsetName} = ${offset}`, `  local ${arrName} = {${raw.map(v => v - offset).join(',')}}`];

  if (m === 'normal') {
    parts.push(`  local ${strName} = ""`);
    parts.push(`  for ${idxName} = 1, #${arrName} do ${strName} = ${strName} .. string.char(${arrName}[${idxName}] + ${offsetName}) end`);
  } else {
    parts.push(`  local ${chunkName} = {}`);
    parts.push(`  for ${idxName} = 1, #${arrName} do ${chunkName}[${idxName}] = string.char(${arrName}[${idxName}] + ${offsetName}) end`);
    parts.push(`  local ${strName} = table.concat(${chunkName})`);
  }

  parts.push(`  local ${fnName} = load or loadstring`);
  parts.push(`  ${fnName}(${strName})`);
  parts.push('end');

  const output = parts.join('\n');

  const blob = new Blob([output], { type: 'text/plain' });
  const url = URL.createObjectURL(blob);
  const link = document.createElement('a');
  link.href = url;
  link.download = 'obfuscated.lua';
  document.body.appendChild(link);
  link.click();
  document.body.removeChild(link);
  URL.revokeObjectURL(url);
};
</script>
</body>
</html>
