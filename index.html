<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lua Obfuscator</title>
  <style>
    body {
      background-color: #121212;
      color: #ddd;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
      padding: 40px;
    }
    .container {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      max-width: 1200px;
    }
    .card {
      background-color: #1e1e2e;
      border: 2px solid #282838;
      border-radius: 8px;
      padding: 20px;
      width: 100%;
      max-width: 600px;
      box-shadow: 0 0 10px rgba(0,255,255,0.2);
    }
    .card h2 {
      color: #0ff;
      margin-top: 0;
      text-shadow: 0 0 5px #0ff;
    }
    input[type=file], textarea {
      width: 100%;
      background: #2e2e3e;
      border: 1px solid #444;
      border-radius: 4px;
      color: #fff;
      padding: 10px;
      margin: 10px 0;
      box-sizing: border-box;
      font-family: monospace;
      font-size: 1rem;
    }
    textarea {
      height: 200px;
      resize: vertical;
    }
    button {
      background-color: #0ff;
      color: #000;
      border: none;
      padding: 10px 20px;
      margin: 5px 2px;
      border-radius: 4px;
      cursor: pointer;
      box-shadow: 0 0 5px #0ff;
      font-size: 1rem;
      font-weight: bold;
    }
    button:hover {
      background-color: #0cc;
    }
    .actions {
      display: flex;
      flex-wrap: wrap;
    }
    .actions button {
      flex: 1 1 auto;
      margin-right: 10px;
    }
    .actions button:last-child {
      margin-right: 0;
    }
    @media (max-width: 768px) {
      .container {
        flex-direction: column;
        align-items: center;
      }
      .card {
        max-width: 90%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Input card -->
    <div class="card">
      <h2>Lua Code Input</h2>
      <input type="file" id="fileInput" accept=".lua" />
      <textarea id="input" placeholder="Enter Lua code here or upload a .lua file above"></textarea>
      <div class="actions">
        <button id="obfuscateButton">Obfuscate Code</button>
      </div>
    </div>

    <!-- Output card -->
    <div class="card">
      <h2>Obfuscated Output</h2>
      <textarea id="output" readonly placeholder="Obfuscated code will appear here"></textarea>
      <div class="actions">
        <button id="copyButton">Copy to Clipboard</button>
        <button id="downloadButton">Download .lua File</button>
      </div>
    </div>
  </div>

  <script>
    // Utility: Generate a random variable name (letters and digits, starting with a letter)
    function randomVarName() {
      const chars = 'abcdefghijklmnopqrstuvwxyz';
      const charsAndDigits = 'abcdefghijklmnopqrstuvwxyz0123456789';
      let name = '';
      // First character letter
      name += chars.charAt(Math.floor(Math.random() * chars.length));
      // Additional 5-8 characters
      const length = Math.floor(Math.random() * 4) + 5;
      for (let i = 0; i < length; i++) {
        name += charsAndDigits.charAt(Math.floor(Math.random() * charsAndDigits.length));
      }
      return name;
    }

    // Handle file upload: read .lua file as text using FileReader7
    document.getElementById('fileInput').addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (!file) return;
      if (!file.name.endsWith('.lua')) {
        alert('Please select a Lua (.lua) file.');
        return;
      }
      const reader = new FileReader();
      reader.onload = function(evt) {
        document.getElementById('input').value = evt.target.result;
      };
      reader.readAsText(file);
    });

    // Obfuscate code on button click
    document.getElementById('obfuscateButton').addEventListener('click', function() {
      const code = document.getElementById('input').value;
      if (!code) {
        alert('Please enter or upload some Lua code first.');
        return;
      }
      // Convert code string to an array of char codes
      const chars = [...code];
      const codes = chars.map(c => c.charCodeAt(0));
      const minCode = Math.min(...codes);
      // Choose an offset (1 to minCode-1) so decoded values stay valid
      let offset = 1;
      if (minCode > 1) {
        offset = Math.floor(Math.random() * (minCode - 1)) + 1;
      }
      // Generate random variable names for obfuscation
      const arrName = randomVarName();
      const offsetName = randomVarName();
      const tempTable = randomVarName();
      const concatFunc = randomVarName();

      // Build numeric table (applying the offset)
      const dataArray = codes.map(n => n + offset);
      const dataString = dataArray.join(',');

      // Split offset into two parts (simple arithmetic trick)
      let part1 = Math.floor(Math.random() * offset);
      let part2 = offset - part1;
      if (part1 === 0) {
        part1 = offset;
        part2 = 0;
      }
      // Construct the obfuscated Lua code snippet
      const obfCode = 
`local ${arrName} = {${dataString}}
local ${offsetName} = ${part1} + ${part2}
local ${tempTable} = {}
for i = 1, #${arrName} do
  ${tempTable}[i] = string.char(${arrName}[i] - ${offsetName})
end
local ${concatFunc} = (loadstring or load)(table.concat(${tempTable}))
${concatFunc}()
`;
      // Output the obfuscated code
      document.getElementById('output').value = obfCode;
    });

    // Copy output to clipboard using Clipboard API8
    document.getElementById('copyButton').addEventListener('click', function() {
      const output = document.getElementById('output');
      const text = output.value;
      if (!text) {
        alert('No obfuscated code to copy.');
        return;
      }
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(function() {
          alert('Obfuscated code copied to clipboard.');
        }).catch(function(err) {
          // Fallback for older browsers
          output.select();
          document.execCommand('copy');
          alert('Obfuscated code copied to clipboard.');
        });
      } else {
        output.select();
        document.execCommand('copy');
        alert('Obfuscated code copied to clipboard.');
      }
    });

    // Download output as .lua file using Blob and createObjectURL9
    document.getElementById('downloadButton').addEventListener('click', function() {
      const text = document.getElementById('output').value;
      if (!text) {
        alert('No obfuscated code to download.');
        return;
      }
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'obfuscated.lua';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
