<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>A$$ OBFUSCATOR</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      background: #111;
      color: #eee;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 1rem;
    }
    .card {
      background: linear-gradient(145deg,#1c1c1c,#0a0a0a);
      border-radius: 1rem;
      box-shadow: 10px 10px 20px #000, -10px -10px 20px #222;
      max-width: 600px;
      width: 100%;
      padding: 2rem;
    }
    h1 {
      text-align: center;
      font-size: 2rem;
      margin-bottom: 1.5rem;
      color: #0af;
      text-shadow: 0 0 8px #0af, 0 0 16px #0af;
    }
    label {
      display: block;
      margin: 1rem 0 .5rem;
      font-weight: bold;
    }
    textarea {
      width: 100%;
      height: 120px;
      background: #111;
      color: #ddd;
      border: none;
      border-radius: .5rem;
      padding: .75rem;
      margin-bottom: 1rem;
      resize: vertical;
      box-shadow: inset 4px 4px 8px #000, inset -4px -4px 8px #222;
      font-family: monospace;
    }
    button {
      display: block;
      width: 100%;
      padding: .75rem;
      margin: .5rem 0;
      background: #0af;
      color: #0d0d0d;
      border: none;
      border-radius: .75rem;
      font-weight: bold;
      text-transform: uppercase;
      cursor: pointer;
      box-shadow: 4px 4px 8px #000, -4px -4px 8px #222;
      transition: transform .1s, box-shadow .1s;
    }
    button:active {
      transform: translateY(2px);
      box-shadow: 2px 2px 4px #000, -2px -2px 4px #222;
    }
    @media (max-width: 480px) {
      h1 { font-size: 1.5rem; }
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>A$$ OBFUSCATOR</h1>

    <label for="inCode">Paste your Lua code</label>
    <textarea id="inCode" placeholder="-- your Lua code here"></textarea>

    <button id="btnObf">Obfuscate â†’ Bytecode</button>

    <label for="outCode">Obfuscated Output</label>
    <textarea id="outCode" readonly placeholder="Your obfuscated code will appear here"></textarea>

    <button id="btnCopy">Copy Output</button>
    <button id="btnDl">Download .lua</button>
  </div>

  <!-- Fengari VM in JS/WASM -->
  <script src="https://unpkg.com/fengari-web/dist/fengari-web.js"></script>
  <script>
    const { lua, lauxlib, to_luastring, to_jsstring } = fengari;
    // Create a new Lua state
    const L = lauxlib.luaL_newstate();
    lua.luaL_openlibs(L);

    const inCode  = document.getElementById('inCode');
    const outCode = document.getElementById('outCode');
    const btnObf  = document.getElementById('btnObf');
    const btnCopy = document.getElementById('btnCopy');
    const btnDl   = document.getElementById('btnDl');

    btnObf.addEventListener('click', () => {
      const src = inCode.value;
      if (!src.trim()) return alert('Please paste your Lua code.');

      // Build a chunk that returns the bytecode dump
      const chunk = to_luastring(
        `local f = loadstring([==[${src}]==]) or load([==[${src}]==])\n` +
        `return string.dump(f)`
      );

      lauxlib.luaL_loadbuffer(L, chunk, null, to_luastring("obfuscator"));
      lua.lua_pcall(L, 0, 1, 0);

      // Get the bytecode as a JS string
      const dumped = to_jsstring(lua.lua_tostring(L, -1));

      // Base64-encode it
      const b64 = btoa(dumped);

      // Build the final Lua stub
      const obf =
`--[[OBFUSCATED BY A$$ OBFUSCATOR A.K.A Reo]]--
local b = "${b64}"
local bytecode = game:GetService("HttpService"):Base64Decode(b)
local f = loadstring or load
f(bytecode)()`;

      outCode.value = obf;

      // clear the Lua stack
      lua.lua_settop(L, 0);
    });

    btnCopy.addEventListener('click', () => {
      if (!outCode.value) return;
      navigator.clipboard.writeText(outCode.value)
        .then(() => alert('Copied!'))
        .catch(() => alert('Copy failed'));
    });

    btnDl.addEventListener('click', () => {
      if (!outCode.value) return;
      const blob = new Blob([outCode.value], { type: 'text/plain' });
      const url  = URL.createObjectURL(blob);
      const a    = document.createElement('a');
      a.href     = url;
      a.download = 'obfuscated.lua';
      a.click();
      URL.revokeObjectURL(url);
    });
  </script>
</body>
</html>
