<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>REO Obfuscator</title>
<style>
  .mode-btn {
    background-color: red;
    color: white;
    padding: 8px 16px;
    margin: 5px;
    border: none;
    cursor: pointer;
  }
  .mode-btn.selected {
    background-color: green;
  }
  #obfuscateBtn {
    background-color: #007BFF;
    color: white;
    padding: 8px 16px;
    margin: 5px;
    border: none;
    cursor: pointer;
  }
  #codeInput {
    width: 90%;
    height: 200px;
    margin-top: 10px;
    font-family: monospace;
  }
</style>
</head>
<body>
<h1>REO Obfuscator</h1>
<button id="normalBtn" class="mode-btn">Normal Mode</button>
<button id="hardBtn" class="mode-btn">Hard Mode</button>
<br>
<input type="file" id="fileInput" accept=".lua">
<br>
<textarea id="codeInput" placeholder="Paste your Lua code here"></textarea>
<br>
<button id="obfuscateBtn">Obfuscate</button>

<script>
  // Utility to generate random variable names
  function getRandomName(existing) {
    const firstChars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';
    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_';
    const reserved = ['and','break','do','else','elseif','end','false','for','function','if','in','local','nil','not','or','repeat','return','then','true','until','while','load','loadstring','string','table','concat','char'];
    let name;
    do {
      let len = Math.floor(Math.random() * 4) + 5; // length between 5 and 8
      name = firstChars.charAt(Math.floor(Math.random() * firstChars.length));
      for (let i = 1; i < len; i++) {
        name += chars.charAt(Math.floor(Math.random() * chars.length));
      }
    } while (existing.includes(name) || reserved.includes(name.toLowerCase()));
    existing.push(name);
    return name;
  }

  // Handle mode button selection
  let normalBtn = document.getElementById('normalBtn');
  let hardBtn = document.getElementById('hardBtn');
  let selectedMode = null;

  normalBtn.addEventListener('click', function() {
    normalBtn.classList.add('selected');
    hardBtn.classList.remove('selected');
    selectedMode = 'normal';
  });

  hardBtn.addEventListener('click', function() {
    hardBtn.classList.add('selected');
    normalBtn.classList.remove('selected');
    selectedMode = 'hard';
  });

  // Handle file upload
  document.getElementById('fileInput').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        document.getElementById('codeInput').value = e.target.result;
      };
      reader.readAsText(file);
    }
  });

  // Obfuscate and download
  document.getElementById('obfuscateBtn').addEventListener('click', function() {
    let mode = selectedMode;
    if (!mode) {
      // default to normal if none selected
      mode = 'normal';
      normalBtn.classList.add('selected');
    }
    let code = document.getElementById('codeInput').value;
    // Convert code to byte values
    let bytes = [];
    for (let i = 0; i < code.length; i++) {
      bytes.push(code.charCodeAt(i));
    }

    // Prepare random names
    let usedNames = [];
    let arrName = getRandomName(usedNames);
    let strName = getRandomName(usedNames);
    let fnName = getRandomName(usedNames);
    let idxName = getRandomName(usedNames);
    let tableName = null;
    if (mode === 'hard') {
      tableName = getRandomName(usedNames);
    }

    // Build obfuscated code lines
    let lines = [];
    lines.push('--[[ OBFUSCATED BY REO OBFUSCATOR ]]--');
    lines.push('do');
    // Array of bytes
    if (bytes.length <= 50) {
      lines.push('  local ' + arrName + ' = {' + bytes.join(', ') + '}');
    } else {
      lines.push('  local ' + arrName + ' = {');
      for (let i = 0; i < bytes.length; i += 50) {
        let chunk = bytes.slice(i, i + 50).join(', ');
        if (i + 50 < bytes.length) {
          lines.push('    ' + chunk + ',');
        } else {
          lines.push('    ' + chunk);
        }
      }
      lines.push('  }');
    }

    if (mode === 'normal') {
      lines.push('  local ' + strName + ' = ""');
      lines.push('  for ' + idxName + ' = 1, #' + arrName + ' do');
      lines.push('    ' + strName + ' = ' + strName + ' .. string.char(' + arrName + '[' + idxName + '])');
      lines.push('  end');
    } else {
      // hard mode
      lines.push('  local ' + tableName + ' = {}');
      lines.push('  for ' + idxName + ' = 1, #' + arrName + ' do');
      lines.push('    ' + tableName + '[' + idxName + '] = string.char(' + arrName + '[' + idxName + '])');
      lines.push('  end');
      lines.push('  local ' + strName + ' = table.concat(' + tableName + ')');
    }

    lines.push('  local ' + fnName + ' = load or loadstring');
    lines.push('  ' + fnName + '(' + strName + ')()');
    lines.push('end');

    let obfuscatedCode = lines.join('\n');
    // Create a blob and trigger download
    let blob = new Blob([obfuscatedCode], { type: 'text/plain' });
    let url = URL.createObjectURL(blob);
    let a = document.createElement('a');
    a.href = url;
    a.download = 'obfuscated.lua';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  });
</script>
</body>
</html>
